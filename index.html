<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; 
               connect-src 'self' https://nzpcdqsrncldrtmqgegi.supabase.co; 
               script-src 'self' 'unsafe-inline'; 
               style-src 'self' 'unsafe-inline'; 
               img-src 'self' data: https: blob:;">
    <!-- TÃ­tulo e descriÃ§Ã£o -->
    <title>Essentia - Seu Controle Nutricional Inteligente</title>
    <meta name="description" content="Controle suas refeiÃ§Ãµes, hidrataÃ§Ã£o e conquiste medalhas por seus objetivos! Acompanhamento nutricional completo e gamificado." />
    <meta name="author" content="Essentia Team" />
    <meta name="keywords" content="nutriÃ§Ã£o, saÃºde, fitness, refeiÃ§Ãµes, hidrataÃ§Ã£o, medalhas, acompanhamento" />

    <!-- Meta tags essenciais para PWA -->
    <meta name="theme-color" content="#3B82F6" />
    <meta name="msapplication-TileColor" content="#3B82F6" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Essentia" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="Essentia" />

    <!-- Favicon e Ã­cones -->
    <link rel="icon" type="image/x-icon" href="/Essentia.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/Essentia.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/Essentia.png" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/Essentia.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/Essentia.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/Essentia.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/Essentia.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/Essentia.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/Essentia.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/Essentia.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/Essentia.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/Essentia.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="/Essentia.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/Essentia.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="/Essentia.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="/Essentia.png" />

    <!-- Android Icons -->
    <link rel="icon" sizes="192x192" href="/Essentia.png" />
    <link rel="icon" sizes="512x512" href="/Essentia.png" />

    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json" crossorigin="use-credentials" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="/" />
    <meta property="og:title" content="Essentia - Seu Controle Nutricional Inteligente" />
    <meta property="og:description" content="Controle suas refeiÃ§Ãµes, hidrataÃ§Ã£o e conquiste medalhas por seus objetivos! Acompanhamento nutricional completo e gamificado." />
    <meta property="og:image" content="/Essentia.png" />
    <meta property="og:image:width" content="512" />
    <meta property="og:image:height" content="512" />
    <meta property="og:locale" content="pt_BR" />
    <meta property="og:site_name" content="Essentia" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="/" />
    <meta property="twitter:title" content="Essentia - Seu Controle Nutricional Inteligente" />
    <meta property="twitter:description" content="Controle suas refeiÃ§Ãµes, hidrataÃ§Ã£o e conquiste medalhas por seus objetivos! Acompanhamento nutricional completo e gamificado." />
    <meta property="twitter:image" content="/Essentia.png" />

    <!-- Preload para performance -->
    <link rel="preload" href="/Essentia.png" as="image" type="image/png" />
    
    <!-- SeguranÃ§a -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:;" />
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Script otimizado para PWA -->
    <script>
      // Debug e inicializaÃ§Ã£o do PWA
      console.log('ðŸš€ Essentia - Inicializando aplicaÃ§Ã£o...');
      
      // Registrar Service Worker para PWA
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/service-worker.js')
            .then(function(registration) {
              console.log('âœ… Service Worker registrado com sucesso:', registration);
              console.log('ðŸ“¦ Escopo do Service Worker:', registration.scope);
              
              // Verificar se hÃ¡ updates
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                console.log('ðŸ”„ Nova versÃ£o do Service Worker encontrada:', newWorker);
                
                newWorker.addEventListener('statechange', () => {
                  console.log('ðŸ“ Estado do novo Service Worker:', newWorker.state);
                });
              });
            })
            .catch(function(error) {
              console.error('âŒ Falha no registro do Service Worker:', error);
            });
        });

        // Monitorar mudanÃ§as no Service Worker
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          console.log('ðŸ”„ Controller do Service Worker mudou - recarregando pÃ¡gina...');
          window.location.reload();
        });
      } else {
        console.log('â„¹ï¸ Service Worker nÃ£o suportado neste navegador');
      }

      // Detectar modo de exibiÃ§Ã£o PWA
      function checkDisplayMode() {
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
        const isFullscreen = window.matchMedia('(display-mode: fullscreen)').matches;
        const isMinimalUI = window.matchMedia('(display-mode: minimal-ui)').matches;
        const isIOSStandalone = window.navigator.standalone;
        
        const isPWA = isStandalone || isFullscreen || isMinimalUI || isIOSStandalone;
        
        console.log('ðŸ“± Modo de ExibiÃ§Ã£o:', {
          standalone: isStandalone,
          fullscreen: isFullscreen,
          minimalUI: isMinimalUI,
          iOSStandalone: isIOSStandalone,
          isPWA: isPWA
        });

        if (isPWA) {
          document.documentElement.classList.add('pwa-mode');
          console.log('ðŸŽ‰ Executando como PWA instalado!');
        } else {
          document.documentElement.classList.add('browser-mode');
          console.log('ðŸŒ Executando no navegador');
        }
      }

      // Verificar permissÃµes de notificaÃ§Ã£o
      function checkNotificationPermission() {
        console.log('ðŸ”” Status da permissÃ£o de notificaÃ§Ã£o:', Notification.permission);
        
        if (Notification.permission === 'default') {
          console.log('ðŸ’¡ NotificaÃ§Ãµes: PermissÃ£o nÃ£o solicitada ainda');
        } else if (Notification.permission === 'granted') {
          console.log('âœ… NotificaÃ§Ãµes: PermissÃ£o concedida');
        } else if (Notification.permission === 'denied') {
          console.log('âŒ NotificaÃ§Ãµes: PermissÃ£o negada');
        }
      }

      // Detectar dispositivo e navegador
      function detectDevice() {
        const userAgent = navigator.userAgent;
        const isIOS = /iPad|iPhone|iPod/.test(userAgent);
        const isAndroid = /Android/.test(userAgent);
        const isChrome = /Chrome/.test(userAgent);
        const isSafari = /Safari/.test(userAgent) && !/Chrome/.test(userAgent);
        
        console.log('ðŸ“Š DetecÃ§Ã£o de Dispositivo:', {
          userAgent: userAgent.substring(0, 100) + '...',
          isIOS: isIOS,
          isAndroid: isAndroid,
          isChrome: isChrome,
          isSafari: isSafari,
          platform: navigator.platform,
          vendor: navigator.vendor
        });

        // Adicionar classes CSS para targeting especÃ­fico
        if (isIOS) document.documentElement.classList.add('ios-device');
        if (isAndroid) document.documentElement.classList.add('android-device');
        if (isChrome) document.documentElement.classList.add('chrome-browser');
        if (isSafari) document.documentElement.classList.add('safari-browser');
      }

      // Inicializar verificaÃ§Ãµes quando DOM estiver pronto
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          checkDisplayMode();
          checkNotificationPermission();
          detectDevice();
        });
      } else {
        checkDisplayMode();
        checkNotificationPermission();
        detectDevice();
      }

      // Monitorar mudanÃ§as no display mode (quando instala/desinstala PWA)
      window.matchMedia('(display-mode: standalone)').addEventListener('change', (e) => {
        console.log('ðŸ”„ MudanÃ§a no modo de display:', e.matches ? 'PWA' : 'Navegador');
        checkDisplayMode();
      });

      // Evento quando o PWA Ã© instalado
      window.addEventListener('appinstalled', (evt) => {
        console.log('ðŸŽ‰ PWA instalado com sucesso!', evt);
        // Aqui vocÃª pode enviar analytics ou mostrar mensagem de boas-vindas
      });

      // Evento beforeinstallprompt (para Chrome/Android)
      window.addEventListener('beforeinstallprompt', (e) => {
        console.log('ðŸŽ¯ PWA pode ser instalado - beforeinstallprompt disparado');
        e.preventDefault();
        // VocÃª pode salvar este evento para mostrar o banner de instalaÃ§Ã£o depois
        window.deferredInstallPrompt = e;
      });

      console.log('âœ¨ Essentia - Script de inicializaÃ§Ã£o concluÃ­do');
    </script>

    <!-- CSS para modos especÃ­ficos -->
    <style>
      /* Estilos para modo PWA */
      .pwa-mode {
        /* Adicione estilos especÃ­ficos para quando estiver rodando como PWA */
      }
      
      .browser-mode {
        /* Estilos para modo navegador */
      }
      
      /* Melhorar experiÃªncia em dispositivos mÃ³veis */
      @media (max-width: 768px) {
        body {
          -webkit-tap-highlight-color: transparent;
          -webkit-touch-callout: none;
          -webkit-user-select: none;
          user-select: none;
        }
      }
      
      /* Prevenir zoom em inputs em iOS */
      @media screen and (max-width: 768px) {
        input, select, textarea {
          font-size: 16px !important;
        }
      }
    </style>
  </body>
</html>